<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Multi-Step Form</title>
  
  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap" rel="stylesheet">
  
  <style>
    /* ===== RESET & BASE STYLES ===== */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: 'Inter', sans-serif;
    }

    body {
      background-color: #f5f5f5;
    }

    /* ===== PROGRESS BAR ===== */
    .msf-topbar {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      height: 6px;
      background: #eef2f6;
      z-index: 9999;
    }

    .msf-topbar__fill {
      height: 100%;
      width: 0%;
      background: #fe6337;
      transition: width 0.25s ease;
    }

    /* ===== FORM LAYOUT ===== */
    .form-wrapper {
      padding: 40px;
      position: relative;
      max-width: 800px;
      background-color: #ffffff;
      margin: 0 auto;
      border-radius: 24px;
    }

    .msf-step {
      display: none;
    }

    .msf-step.is-active {
      display: block;
    }

    /* ===== HEADER ===== */
    .msf-header {
      position: relative;
      display: flex;
      align-items: center;
      min-height: 44px;
      margin: 0 0 12px;
    }

    .msf-header .msf-btn.back {
      position: absolute;
      left: 0;
      top: 0;
    }

    .msf-header__logo {
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
      width: auto;
      opacity: 0.9;
    }

    /* ===== NAVIGATION ===== */
    .msf-nav {
      display: flex;
      gap: 8px;
      justify-content: flex-end;
      align-items: center;
      padding: 16px 0 8px 0;
    }

    /* ===== BUTTONS ===== */
    .msf-btn {
      appearance: none;
      border: 1px solid #d0d7de;
      background: #fff;
      color: #24292f;
      border-radius: 10px;
      padding: 10px 14px;
      font: 600 14px/1 system-ui;
      cursor: pointer;
      transition: transform 0.02s ease;
    }

    .msf-btn:active {
      transform: translateY(1px);
    }

    .msf-btn[disabled] {
      opacity: 0.45;
      cursor: not-allowed;
    }

    .msf-btn.primary {
      background: #fe6337;
      color: #fff;
      border-color: #fe6337;
      display: block;
      width: 100%;
      height: 40px;
    }

    .msf-btn.primary[disabled] {
      background: #a8a8a8;
      border-color: #a8a8a8;
      color: #fff;
    }

    .msf-btn.back {
      background: #fff;
    }

    .msf-btn.back::before {
      content: '←';
      margin-right: 6px;
    }

    .msf-btn.back[disabled] {
      opacity: 0.5;
      cursor: not-allowed;
    }

    /* ===== TYPOGRAPHY ===== */
    h1 {
      text-align: center;
      font-size: 20px;
      color: #313131;
      margin-top: 40px;
      font-weight: 600;
      margin-bottom: 32px;
    }

    h2 {
      font-size: 20px;
      font-style: normal;
      font-weight: 600;
      color: #13828A;
      text-align: center;
      padding: 24px 0 12px 0;
    }

    p {
      text-align: center;
      font-size: 14px;
      color: #808080;
    }

    /* ===== FORM ELEMENTS ===== */
    fieldset {
      max-width: inherit !important;
    }

    fieldset.form-columns-1 {
      margin: 32px 0 !important;
    }

    fieldset.form-columns-2,
    fieldset.form-columns-3 {
      display: flex;
      gap: 32px;
      margin-bottom: 32px !important;
    }

    label {
      font-size: 14px;
    }

    input {
      width: 100%;
      max-width: inherit !important;
      border-radius: 8px;
      border: 1px solid #ccc;
      height: 40px;
      margin-top: 8px;
    }

    input[type="radio" i] {
      height: auto !important;
      width: inherit !important;
    }

    select {
      height: 40px;
      border-radius: 8px;
      border: 1px solid #ccc;
      margin-top: 8px;
    }

    .hs-input {
      width: 100% !important;
      padding-left: 16px;
      font-size: 14px;
      font-weight: 400;
    }

    /* ===== VALIDATION & ERRORS ===== */
    span.hs-form-required {
      color: red !important;
    }

    label.hs-error-msg.hs-main-font-element {
      color: red;
      font-size: 12px;
    }

    ul.no-list.hs-error-msgs.inputs-list {
    position: absolute;
}

    li {
      list-style-type: none;
    }

    li.hs-error-msg {
      list-style-type: none !important;
    }

    /* ===== SUBMIT BUTTON ===== */
    .msf-submit.actions {
      display: flex;
      justify-content: flex-end;
    }

    .banner {
      background-image: url('https://20661566.fs1.hubspotusercontent-na1.net/hubfs/20661566/jemsystemcover%201.png');
      height: 300px;
      background-repeat: no-repeat;
      background-position: center center;
      background-size: cover;
      margin-bottom: -240px;
    }

    /* ===== RESPONSIVE DESIGN ===== */
    @media (max-width: 800px) {
      fieldset.form-columns-2,
      fieldset.form-columns-3 {
        flex-direction: column;
      }

      .hs-form-field {
        width: 100% !important;
      }
      .form-wrapper {
        margin: 0 24px;
      }
      .banner {
        margin-bottom: -180px;
      }
    }

    .radio-group {
  display: none;
  margin-left: 20px; /* optional for indentation */
}

input[type="checkbox" i] {
    width: max-content!important;
    height: max-content;
    margin-right: 4px;
}

.building_occupancy_type0 {
    display: flex;
}

li.hs-form-checkbox {
    padding: 12px 16px;
    border-bottom: 1px solid #c0c0c0;
}

/* DROPDOWN */
.dropdown{border:1px solid #ccc;border-radius:8px;overflow:hidden;background:#fff}
.dropdown__button{width:100%;appearance:none;background:#fff;border:0;padding:14px 16px;text-align:left;font-weight:600;cursor:pointer;display:flex;align-items:center;justify-content:space-between}
.dropdown__button:focus{outline:2px solid #84caff;outline-offset:2px}
.dropdown__chev{transition:transform .2s ease}
.dropdown[aria-expanded="true"] .dropdown__chev{transform:rotate(180deg)}
.dropdown__panel{display:none;border-top:1px solid #eef2f6;}
.dropdown[aria-expanded="true"] .dropdown__panel{display:block}

/* LIST + CHOICES */
.inputs-list{margin:0;padding:0}
.inputs-list>li{list-style:none;}
.inputs-list>li:last-child{border-bottom:0}
.hs-form-checkbox>label{display:inline-flex;align-items:end;gap:8px;cursor:pointer;font-weight:600}
input[type="checkbox"]{width:18px;height:18px;accent-color:#fe6337}
.radio-group{display:none;margin:8px 0 0 26px}
.radio-group .inputs-list>li{border:0;}
.radio-group label{display:inline-flex;align-items:center;font-weight:400;cursor:pointer}
input[type="radio"]{accent-color:#fe6337}

/* INLINE ERROR */
.validation-error{color:#ef4444;font-size:12px;display:block;margin-top:6px}

.building-occupancy-error {
    color: red;
    font-size: 12px;
    margin-top: 8px;
    padding: 8px;
    border-radius: 4px;
    font-weight: 500;
    position: absolute;
}

li.hs-form-checkbox:hover {
    background-color: #f5f5f5;
}

.input {
    margin-right: 0px!important;
}

/* Checkbox */
input[type="checkbox"] {
  appearance: none;
  width: 18px!important;
  height: 18px!important;
  border: 2px solid #c7cdd3;
  border-radius: 4px;
  background: #fff;
  display: inline-block;
  position: relative;
}
input[type="checkbox"]:checked {
  background: #13828A;            /* box fill color */
  border-color: #13828A;
}
input[type="checkbox"]:checked::after {
  content: "";
  position: absolute;
  inset: 2px 5px 5px 2px;         /* draws the checkmark */
  border: solid #fff;
  border-width: 0 2px 2px 0;
  transform: rotate(45deg);
}

/* Radio (custom) */
input[type="radio"] {
  appearance: none;
  width: 18px !important;
  height: 18px !important;
  border-radius: 50%;
  background: #fff;
  position: relative;
  display: inline-block !important;
  vertical-align: bottom;
  margin-right: 8px;
}

input[type="radio"]::after {
  content: "";
  position: absolute;
  top: 50%;
  left: 50%;
  width: 10px;                   /* inner dot size */
  height: 10px;
  background: #13828A;           /* dot color */
  border-radius: 50%;
  transform: translate(-50%, -50%) scale(0);
  transition: transform .12s ease;
}

input[type="radio"]:checked {
  border-color: #13828A;         /* outer ring color when checked */    /* optional focus-style ring */
  outline-offset: 0;             /* adjust as desired */
}

input[type="radio"]:checked::after {
  transform: translate(-50%, -50%) scale(1);
}



  </style>
</head>

<body>
  <div class="banner">

  </div>
  <div class="form-wrapper">
    <!-- Header with Back button and Logo -->
    <div class="msf-header">
      <button type="button" class="msf-btn back" id="globalBackBtn">Back</button>
      <img class="msf-header__logo" alt="Logo" width="240" src="https://20661566.fs1.hubspotusercontent-na1.net/hubfs/20661566/logo-jem-1.png" />
    </div>

    <h2>Professional Services Request</h2>
    <p>We strive to deliver the best service for our customers. In order to do that, we need a little bit more information about the project to best serve you. </p>

    <!-- HubSpot Form -->
    <script charset="utf-8" type="text/javascript" src="http://js.hsforms.net/forms/embed/v2.js"></script>
    <script>
      hbspt.forms.create({
        portalId: "20661566",
        formId: "b1918b8e-61ec-4407-94bd-8c949ebc59a4",
        region: "na1"
      });
    </script>
  </div>

<script>
/* Event delegation: works for injected content */
document.addEventListener('change', (e) => {
  /* Top-level checkbox toggles visibility of its sibling .radio-group */
  if (e.target.matches('.hs-form-checkbox > label > input[type="checkbox"]')) {
    const li = e.target.closest('.hs-form-checkbox');
    const radioGroup = li.querySelector('.radio-group');
    if (radioGroup) {
      radioGroup.style.display = e.target.checked ? 'block' : 'none';
      radioGroup.setAttribute('aria-hidden', e.target.checked ? 'false' : 'true');

      /* If unchecked, clear any radios inside */
      if (!e.target.checked) {
        radioGroup.querySelectorAll('input[type="radio"]').forEach(r => r.checked = false);
      }
    }
  }

  /* If a radio is picked, ensure its parent checkbox is checked & visible */
  if (e.target.matches('.radio-group input[type="radio"]')) {
    const li = e.target.closest('.hs-form-checkbox');                  // go up to the group <li>
    const parentCheckbox = li?.querySelector(':scope > label input[type="checkbox"]'); // only the top-level checkbox
    if (parentCheckbox && !parentCheckbox.checked) {
      parentCheckbox.checked = true;
      /* Trigger change so the radio group becomes visible */
      parentCheckbox.dispatchEvent(new Event('change', { bubbles: true }));
    }
  }
});

/* Initialize visibility for any pre-checked boxes (callable anytime, including after you inject the fieldset) */
function initRadioVisibility() {
  document.querySelectorAll('.hs-form-checkbox > label > input[type="checkbox"]').forEach(cb => {
    const li = cb.closest('.hs-form-checkbox');
    const radioGroup = li.querySelector('.radio-group');
    if (radioGroup) {
      radioGroup.style.display = cb.checked ? 'block' : 'none';
      radioGroup.setAttribute('aria-hidden', cb.checked ? 'false' : 'true');
    }
  });
}

/* Run on load */
document.addEventListener('DOMContentLoaded', initRadioVisibility);

/* ALSO call this right after you append the new fieldset */
window.initRadioVisibility = initRadioVisibility; // expose if you want to call it explicitly
</script>


  <!-- Multi-Step Form Logic -->
  <script>
    (() => {
      const FORM_SELECTOR = '#hsForm_b1918b8e-61ec-4407-94bd-8c949ebc59a4';

      const isVisible = el => !!(el.offsetParent || el.getClientRects().length);
      const qsa = (root, sel) => Array.from(root.querySelectorAll(sel));

      function isHsFieldWrapperValid(wrapper) {
        const required = !!wrapper.querySelector('.hs-form-required');
        const controls = qsa(wrapper, 'input, select, textarea');

        for (const c of controls) {
          if (!isVisible(c) || c.type === 'hidden' || c.disabled) continue;
          if (c.willValidate && !c.checkValidity()) return false;
        }

        if (!required) return true;

        const radios = qsa(wrapper, 'input[type="radio"]');
        if (radios.length) return radios.some(r => r.checked);

        const checkboxes = qsa(wrapper, 'input[type="checkbox"]');
        if (checkboxes.length) return checkboxes.some(c => c.checked);

        const fileInputs = qsa(wrapper, 'input[type="file"]');
        if (fileInputs.length) return fileInputs.every(f => f.files && f.files.length > 0);

        const selects = qsa(wrapper, 'select');
        if (selects.length) return selects.every(s => (s.value || '').trim() !== '');

        const textInputs = controls.filter(c => ['INPUT', 'TEXTAREA'].includes(c.tagName));
        if (textInputs.length) return textInputs.every(c => (c.value || '').trim() !== '');

        return true;
      }

      function isStepValid(step) {
        const wrappers = qsa(step, '.hs-form-field');
        for (const w of wrappers) {
          if (!isHsFieldWrapperValid(w)) return false;
        }
        return true;
      }

      function firstInvalidInStep(step) {
        const wrappers = qsa(step, '.hs-form-field');
        for (const w of wrappers) {
          if (!isHsFieldWrapperValid(w)) {
            return w.querySelector('input, select, textarea');
          }
        }
        return null;
      }

      function validateTakeOffSectionFields() {
        const section = document.querySelector('.msf-step[data-title="Take-off Information"]');
        if (!section || !isVisible(section)) return true;

        let isValid = true;

        const requiredFields = [
          {
            selector: 'input[name="scope"]',
            type: 'radio'
          },
          {
            selector: 'input[name="what_is_the_due_date_for_submission_"]',
            type: 'input'
          },
          {
            selector: 'input[name="take_off_price"]',
            type: 'input'
          },
          {
            selector: 'input[name="po_number"]',
            type: 'input'
          }
        ];

        requiredFields.forEach(field => {
          const inputs = Array.from(section.querySelectorAll(field.selector));

          if (field.type === 'radio') {
            const checked = inputs.some(i => i.checked);
            const wrapper = inputs[0]?.closest('.hs-form-field');
            if (!checked) {
              isValid = false;
              wrapper?.classList.add('field-error');
            } else {
              wrapper?.classList.remove('field-error');
            }
          } else {
            const input = inputs[0];
            const wrapper = input?.closest('.hs-form-field');
            if (!input || input.value.trim() === '') {
              isValid = false;
              wrapper?.classList.add('field-error');
            } else {
              wrapper?.classList.remove('field-error');
            }
          }
        });

        return isValid;
      }

      function validateBuildingOccupancySection() {
        const section = document.querySelector('.msf-step[data-title="Project Information"]');
        if (!section || !isVisible(section)) return true;

        const buildingOccupancyContainer = section.querySelector('.hs_building_occupancy_type');
        if (!buildingOccupancyContainer) return true;

        let isValid = true;
        let hasCheckedCheckbox = false;
        let hasCheckedRadio = false;
        let hasCheckboxesWithRadios = false;

        // Check if at least one checkbox is selected
        const checkboxes = buildingOccupancyContainer.querySelectorAll('input[type="checkbox"]');
        hasCheckedCheckbox = Array.from(checkboxes).some(cb => cb.checked);

        // Check if any checked checkbox has radio buttons associated with it
        const checkedCheckboxes = Array.from(checkboxes).filter(cb => cb.checked);
        checkedCheckboxes.forEach(cb => {
          const li = cb.closest('.hs-form-checkbox');
          const radios = li.querySelectorAll('.radio-group input[type="radio"]');
          if (radios.length > 0) {
            hasCheckboxesWithRadios = true;
            // Check if at least one radio is selected for this checkbox
            const hasRadioSelected = Array.from(radios).some(radio => radio.checked);
            if (hasRadioSelected) {
              hasCheckedRadio = true;
            }
          }
        });

        // Validation logic:
        // 1. Must have at least 1 checkbox selected
        // 2. If any checked checkbox has radio buttons, at least one radio must be selected
        if (!hasCheckedCheckbox) {
          isValid = false;
          // Show error message
          let errorElement = buildingOccupancyContainer.querySelector('.building-occupancy-error');
          if (!errorElement) {
            errorElement = document.createElement('div');
            errorElement.className = 'building-occupancy-error';
            buildingOccupancyContainer.appendChild(errorElement);
          }
          errorElement.textContent = 'Please select at least one type.';
        } else if (hasCheckboxesWithRadios && !hasCheckedRadio) {
          isValid = false;
          // Show error message
          let errorElement = buildingOccupancyContainer.querySelector('.building-occupancy-error');
          if (!errorElement) {
            errorElement = document.createElement('div');
            errorElement.className = 'building-occupancy-error';
            buildingOccupancyContainer.appendChild(errorElement);
          }
          errorElement.textContent = 'Please select at least one subcategory per building type (if available).';
        } else {
          // Remove error message if validation passes
          const errorElement = buildingOccupancyContainer.querySelector('.building-occupancy-error');
          if (errorElement) {
            errorElement.remove();
          }
        }

        return isValid;
      }

      function buildSteps(form) {
        const steps = [];
        const kids = Array.from(form.children);
        let currentStep = null;

        for (const node of kids) {
          const isH1Fieldset = node.matches('fieldset') && node.querySelector('.hs-richtext h1');
          if (isH1Fieldset) {
            currentStep = document.createElement('section');
            currentStep.className = 'msf-step';
            const title = node.querySelector('h1')?.textContent?.trim() || 'Step';
            currentStep.dataset.title = title;
            form.insertBefore(currentStep, node);
            steps.push(currentStep);
          }
          if (currentStep) currentStep.appendChild(node);
        }

        const submit = form.querySelector('.hs_submit.actions');
        if (submit && steps.length) {
          submit.classList.add('msf-submit', 'actions');
          steps[steps.length - 1].appendChild(submit);
        }

        return steps;
      }

      function addNavUI(form, steps) {
        let topbar = document.getElementById('msf-topbar');
        if (!topbar) {
          topbar = document.createElement('div');
          topbar.id = 'msf-topbar';
          topbar.className = 'msf-topbar';
          const fill = document.createElement('div');
          fill.className = 'msf-topbar__fill';
          topbar.appendChild(fill);
          document.body.prepend(topbar);
        }

        steps.forEach((step, idx) => {
          const nav = document.createElement('div');
          nav.className = 'msf-nav';

          const next = document.createElement('button');
          next.type = 'button';
          next.className = 'msf-btn primary';
          next.textContent = 'Next Section';

          if (idx === steps.length - 1) next.style.display = 'none';

          nav.append(next);
          step.appendChild(nav);

          next.addEventListener('click', () => {
            const currentTitle = step.dataset.title;

            if (!isStepValid(step)) {
              const bad = firstInvalidInStep(step);
              if (bad?.reportValidity) bad.reportValidity();
              bad?.focus();
              return;
            }

            if (currentTitle === 'Take-off Information' && !validateTakeOffSectionFields()) {
              return;
            }

            if (currentTitle === 'Project Information' && !validateBuildingOccupancySection()) {
              return;
            }

            if (currentTitle === 'Plans and Additional Information') {
              const select = document.querySelector('#type_of_services_required_-b1918b8e-61ec-4407-94bd-8c949ebc59a4');
              const selectedValue = select?.value?.trim();

              if (selectedValue === 'Project Design') {
                const designStepIndex = steps.findIndex(s => s.dataset.title === 'Project Design Information');
                if (designStepIndex !== -1) {
                  goTo(designStepIndex);
                  return;
                }
              } else {
                const takeoffStepIndex = steps.findIndex(s => s.dataset.title === 'Take-off Information');
                if (takeoffStepIndex !== -1) {
                  goTo(takeoffStepIndex);
                  return;
                }
              }
            }

            goTo(idx + 1);
          });

          const updateNextState = () => {
            let valid = isStepValid(step);
            if (step.dataset.title === 'Take-off Information') {
              valid = valid && validateTakeOffSectionFields();
            }
            if (step.dataset.title === 'Project Information') {
              valid = valid && validateBuildingOccupancySection();
            }
            next.disabled = !valid;
          };

          qsa(step, 'input, select, textarea').forEach(ctrl => {
            ['input', 'change', 'blur'].forEach(ev => ctrl.addEventListener(ev, updateNextState));
          });

          step.__updateNextState = updateNextState;

          if (idx === steps.length - 1) {
            qsa(form, '.hs_submit.actions').forEach(el => el.style.display = '');
          }
        });

        function renderProgress(activeIndex) {
          const topbar = document.getElementById('msf-topbar');
          if (topbar) {
            const fill = topbar.querySelector('.msf-topbar__fill');
            const total = steps.length;
            const pct = total > 1 ? (activeIndex / (total - 1)) * 100 : 100;
            fill.style.width = `${pct}%`;
          }
        }

        return { renderProgress };
      }

      function init(form) {
        if (form.__msfInit) return;
        form.__msfInit = true;

        const steps = buildSteps(form);
        if (!steps.length) return;

        const { renderProgress } = addNavUI(form, steps);

        let current = 0;

        function show(i) {
          steps.forEach((s, idx) => s.classList.toggle('is-active', idx === i));

          const submit = form.querySelector('.hs_submit.actions');
          if (submit) submit.style.display = i === steps.length - 1 ? '' : 'none';

          steps[i].__updateNextState?.();

          const backBtn = document.getElementById('globalBackBtn');
          if (backBtn) backBtn.disabled = i === 0;

          const bad = firstInvalidInStep(steps[i]);
          const candidate = bad || steps[i].querySelector('input, select, textarea, button');
          candidate?.focus({ preventScroll: true });

          renderProgress(i);
          current = i;
        }

        window.goTo = (i) => {
          if (i < 0 || i >= steps.length) return;
          show(i);
        };

        form.addEventListener('submit', (e) => {
          if (current < steps.length - 1) e.preventDefault();
        });

        show(0);

        const backBtn = document.getElementById('globalBackBtn');
        if (backBtn) {
          backBtn.addEventListener('click', () => {
            const currentStep = steps[current];
            const currentTitle = currentStep.dataset.title;
            const select = document.querySelector('#type_of_services_required_-b1918b8e-61ec-4407-94bd-8c949ebc59a4');
            const selectedValue = select?.value?.trim();

            if (
              currentTitle === 'Project Design Information' &&
              selectedValue === 'Project Design'
            ) {
              const plansStepIndex = steps.findIndex(s => s.dataset.title === 'Plans and Additional Information');
              if (plansStepIndex !== -1) {
                show(plansStepIndex);
                return;
              }
            }

            if (current > 0) show(current - 1);
          });
        }
      }

      const tryInit = () => {
        const f = document.querySelector(FORM_SELECTOR);
        if (f) init(f);
      };

      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', tryInit);
      } else {
        tryInit();
      }

      const mo = new MutationObserver(tryInit);
      mo.observe(document.documentElement, { childList: true, subtree: true });
    })();
  </script>

  <script>
    document.addEventListener('DOMContentLoaded', function () {
      function waitForElement() {
        const targetElement = document.querySelector('[data-title="Project Design Information"]');
        if (targetElement) {
          init();
        } else {
          setTimeout(waitForElement, 100);
        }
      }

      function init() {
        const communicatorFieldYes = document.querySelector('input[name="are_you_adding_a_communicator_to_the_project_"][value="Yes"]');
        const communicatorFieldNo = document.querySelector('input[name="are_you_adding_a_communicator_to_the_project_"][value="No"]');
        
        const communicatorBrandDiv = document.querySelector('.hs_what_is_the_communicator_brand_and_models_');
        const monitoringCompanyDiv = document.querySelector('.hs_what_is_the_monitoring_company_being_used_');
        const monitoringCertificateDiv = document.querySelector('.hs_upload_the_monitoring_company_ul_certificate');

        if (!communicatorFieldYes || !communicatorFieldNo || !communicatorBrandDiv || !monitoringCompanyDiv || !monitoringCertificateDiv) {
          console.error('Alguns elementos não foram encontrados.');
          return;
        }

        function toggleFields() {
          const isCommunicatorYes = communicatorFieldYes.checked;
          
          communicatorBrandDiv.style.display = isCommunicatorYes ? 'block' : 'none';
          monitoringCompanyDiv.style.display = isCommunicatorYes ? 'block' : 'none';
          monitoringCertificateDiv.style.display = isCommunicatorYes ? 'block' : 'none';
        }

        communicatorFieldYes.addEventListener('change', toggleFields);
        communicatorFieldNo.addEventListener('change', toggleFields);

        toggleFields();
      }

      waitForElement();
    });
  </script>

  <script>
  document.addEventListener('DOMContentLoaded', function () {
    // Função para verificar se o elemento com data-title="Project Information" existe
    function waitForElement() {
      const targetElement = document.querySelector('[data-title="Project Information"]');

      // Se o elemento existe, chama a função de inicialização
      if (targetElement) {
        init();
      } else {
        // Caso o elemento não exista ainda, observe o DOM
        setTimeout(waitForElement, 100);  // Tenta novamente após 100ms
      }
    }

    function init() {
      // Identificando o fieldset onde os elementos serão injetados
      const fieldset = document.querySelector('.form-columns-1 .hs_bulding');
      console.log(fieldset)
      if (!fieldset) {
        console.error("O fieldset não foi encontrado.");
        return;
      }
          fieldset.style.display = 'block' ;
          const inputFieldset = document.querySelector('#label-bulding-b1918b8e-61ec-4407-94bd-8c949ebc59a4')
          inputFieldset.style.display = 'block' ;

      const newFieldsetHTML = `
        <section class="dropdown" aria-expanded="false">
          <button type="button" class="dropdown__button" aria-controls="occPanel" aria-expanded="false">
            <span>Building Occupancy type</span>
            <svg class="dropdown__chev" width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true">
              <path d="M6 9l6 6 6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </button>

          <div id="occPanel" class="dropdown__panel">
            <div class="hs_building_occupancy_type hs-fieldtype-checkbox field">
              <div class="input">
                <ul role="group" aria-label="Building Occupancy type" class="inputs-list multi-container">
                  <li class="hs-form-checkbox">
                    <label><input type="checkbox" name="building_occupancy_type" value="Group A (Assembly)"><span>Group A (Assembly)</span></label>
                    <div class="radio-group">
                      <ul class="inputs-list multi-container">
                        <li class="hs-form-radio"><label><input type="radio" name="radio_group_A" value="A-1"><span>A-1</span></label></li>
                        <li class="hs-form-radio"><label><input type="radio" name="radio_group_A" value="A-2"><span>A-2</span></label></li>
                        <li class="hs-form-radio"><label><input type="radio" name="radio_group_A" value="A-3"><span>A-3</span></label></li>
                        <li class="hs-form-radio"><label><input type="radio" name="radio_group_A" value="A-4"><span>A-4</span></label></li>
                        <li class="hs-form-radio"><label><input type="radio" name="radio_group_A" value="A-5"><span>A-5</span></label></li>
                      </ul>
                    </div>
                  </li>

                  <li class="hs-form-checkbox"><label><input type="checkbox" name="building_occupancy_type" value="Group B (Business)"><span>Group B (Business)</span></label></li>
                  <li class="hs-form-checkbox"><label><input type="checkbox" name="building_occupancy_type" value="Group E (Educational)"><span>Group E (Educational)</span></label></li>

                  <li class="hs-form-checkbox">
                    <label><input type="checkbox" name="building_occupancy_type" value="Group F (Factory and Industrial)"><span>Group F (Factory and Industrial)</span></label>
                    <div class="radio-group">
                      <ul class="inputs-list multi-container">
                        <li class="hs-form-radio"><label><input type="radio" name="radio_group_F" value="F-1"><span>F-1</span></label></li>
                        <li class="hs-form-radio"><label><input type="radio" name="radio_group_F" value="F-2"><span>F-2</span></label></li>
                      </ul>
                    </div>
                  </li>

                  <li class="hs-form-checkbox">
                    <label><input type="checkbox" name="building_occupancy_type" value="Group H (High Hazard)"><span>Group H (High Hazard)</span></label>
                    <div class="radio-group">
                      <ul class="inputs-list multi-container">
                        <li class="hs-form-radio"><label><input type="radio" name="radio_group_H" value="H-1"><span>H-1</span></label></li>
                        <li class="hs-form-radio"><label><input type="radio" name="radio_group_H" value="H-2"><span>H-2</span></label></li>
                        <li class="hs-form-radio"><label><input type="radio" name="radio_group_H" value="H-3"><span>H-3</span></label></li>
                        <li class="hs-form-radio"><label><input type="radio" name="radio_group_H" value="H-4"><span>H-4</span></label></li>
                        <li class="hs-form-radio"><label><input type="radio" name="radio_group_H" value="H-5"><span>H-5</span></label></li>
                      </ul>
                    </div>
                  </li>

                  <li class="hs-form-checkbox">
                    <label><input type="checkbox" name="building_occupancy_type" value="Group I (Institutional)"><span>Group I (Institutional)</span></label>
                    <div class="radio-group">
                      <ul class="inputs-list multi-container">
                        <li class="hs-form-radio"><label><input type="radio" name="radio_group_I" value="I-1"><span>I-1</span></label></li>
                        <li class="hs-form-radio"><label><input type="radio" name="radio_group_I" value="I-2"><span>I-2</span></label></li>
                        <li class="hs-form-radio"><label><input type="radio" name="radio_group_I" value="I-3"><span>I-3</span></label></li>
                        <li class="hs-form-radio"><label><input type="radio" name="radio_group_I" value="I-4"><span>I-4</span></label></li>
                      </ul>
                    </div>
                  </li>

                  <li class="hs-form-checkbox"><label><input type="checkbox" name="building_occupancy_type" value="Group M (Mercantile)"><span>Group M (Mercantile)</span></label></li>

                  <li class="hs-form-checkbox">
                    <label><input type="checkbox" name="building_occupancy_type" value="Group R (Residential)"><span>Group R (Residential)</span></label>
                    <div class="radio-group">
                      <ul class="inputs-list multi-container">
                        <li class="hs-form-radio"><label><input type="radio" name="radio_group_R" value="R-1"><span>R-1</span></label></li>
                        <li class="hs-form-radio"><label><input type="radio" name="radio_group_R" value="R-2"><span>R-2</span></label></li>
                        <li class="hs-form-radio"><label><input type="radio" name="radio_group_R" value="R-3"><span>R-3</span></label></li>
                        <li class="hs-form-radio"><label><input type="radio" name="radio_group_R" value="R-4"><span>R-4</span></label></li>
                      </ul>
                    </div>
                  </li>

                  <li class="hs-form-checkbox">
                    <label><input type="checkbox" name="building_occupancy_type" value="Group S (Storage)"><span>Group S (Storage)</span></label>
                    <div class="radio-group">
                      <ul class="inputs-list multi-container">
                        <li class="hs-form-radio"><label><input type="radio" name="radio_group_S" value="S-1"><span>S-1</span></label></li>
                        <li class="hs-form-radio"><label><input type="radio" name="radio_group_S" value="S-2"><span>S-2</span></label></li>
                      </ul>
                    </div>
                  </li>

                  <li class="hs-form-checkbox"><label><input type="checkbox" name="building_occupancy_type" value="Group U (Utility)"><span>Group U (Utility)</span></label></li>
                </ul>
              </div>
            </div>
            <input type="hidden" id="building_occupancy_summary" name="building_occupancy_summary" />
          </div>
        </section>
      `;

      fieldset.innerHTML = newFieldsetHTML;

      // >>> ADD (Dropdown toggle init)
      const dd = fieldset.querySelector('.dropdown');
      const btn = fieldset.querySelector('.dropdown__button');
      const panel = fieldset.querySelector('.dropdown__panel');
      dd.setAttribute('aria-expanded','false');
      btn.setAttribute('aria-expanded','false');
      panel.hidden = true;
      btn.addEventListener('click', () => {
        const open = dd.getAttribute('aria-expanded') !== 'true';
        dd.setAttribute('aria-expanded', open ? 'true' : 'false');
        btn.setAttribute('aria-expanded', open ? 'true' : 'false');
        panel.hidden = !open;
      });

      // Keep radios hidden unless checkbox is pre-checked
      fieldset.querySelectorAll('.hs-form-checkbox > label > input[type="checkbox"]').forEach(cb => {
        const li = cb.closest('.hs-form-checkbox');
        const rg = li.querySelector('.radio-group');
        if (rg) rg.style.display = cb.checked ? 'block' : 'none';
      });

      // Add event listeners to trigger validation when Building Occupancy elements change
      const buildingOccupancyContainer = fieldset.querySelector('.hs_building_occupancy_type');
      if (buildingOccupancyContainer) {
        const allInputs = buildingOccupancyContainer.querySelectorAll('input[type="checkbox"], input[type="radio"]');
        allInputs.forEach(input => {
          input.addEventListener('change', () => {
            // Trigger the step validation update
            const currentStep = document.querySelector('.msf-step.is-active');
            if (currentStep && currentStep.__updateNextState) {
              currentStep.__updateNextState();
            }
          });
        });
      }
    }

    waitForElement();
  });
    

    // Função para monitorar os inputs e atualizar o campo de texto
      const checkboxes = document.querySelectorAll('input[type="checkbox"]');
      const radios = document.querySelectorAll('input[type="radio"]');
      const outputField = document.getElementById('project_name-b1918b8e-61ec-4407-94bd-8c949ebc59a4'); // Campo de texto que vai receber os dados

      // Função para atualizar o campo de texto com as seleções
      function updateOutput() {
        let output = '';
        
        // Adiciona as respostas dos checkboxes
        checkboxes.forEach(function (checkbox) {
          if (checkbox.checked) {
            output += checkbox.nextElementSibling.textContent.trim() + ', ';
          }
        });

        // Adiciona as respostas dos rádios
        radios.forEach(function (radio) {
          if (radio.checked) {
            output += radio.nextElementSibling.textContent.trim() + ', ';
          }
        });

        // Remove a última vírgula e espaço
        if (output.endsWith(', ')) {
          output = output.slice(0, -2);
        }

        // Atualiza o campo de texto
        outputField.value = output;
      }

      // Função para validar se uma checkbox foi selecionada e se os radios associados estão marcados
      function validateCheckboxAndRadio() {
  let valid = true;

  checkboxes.forEach(function (checkbox) {
    // Verifica se a checkbox está marcada
    if (checkbox.checked) {
      const associatedRadios = checkbox.closest('li').querySelectorAll('.radio-group input[type="radio"]');
      const isAnyRadioSelected = Array.from(associatedRadios).some(radio => radio.checked);

      // Se não houver radio selecionado e a checkbox estiver marcada, a validação falha
      if (!isAnyRadioSelected) {
        valid = false;
        showValidationError(checkbox.closest('li'), 'Please select at least one option.');
      } else {
        hideValidationError(checkbox.closest('li')); // Esconde a mensagem de erro se a validação for bem-sucedida
      }
    } else {
      // Caso a checkbox esteja desmarcada, remove a mensagem de erro, se houver
      hideValidationError(checkbox.closest('li'));
    }
  });

  return valid;
}


      // Função para mostrar o erro de validação
      function showValidationError(container, message) {
        let errorElement = container.querySelector('.validation-error');
        if (!errorElement) {
          errorElement = document.createElement('span');
          errorElement.className = 'validation-error';
          errorElement.style.color = 'red';
          errorElement.style.fontSize = '12px';
          errorElement.style.display = 'block';
          container.appendChild(errorElement);
        }
        errorElement.textContent = message;
      }

      // Função para ocultar o erro de validação
      function hideValidationError(container) {
        const errorElement = container.querySelector('.validation-error');
        if (errorElement) {
          errorElement.remove();
        }
      }

      // Adiciona event listeners para mudanças nos checkboxes e rádios
      checkboxes.forEach(function (checkbox) {
        checkbox.addEventListener('change', function () {
          updateOutput();
          if (!checkbox.checked) {
            // Desmarcar todos os rádios quando a checkbox for desmarcada
            const associatedRadios = checkbox.closest('li').querySelectorAll('.radio-group input[type="radio"]');
            associatedRadios.forEach(radio => radio.checked = false);
          }
          validateCheckboxAndRadio(); // Validação após alteração
        });
      });

    radios.forEach(function (radio) {
    radio.addEventListener('change', function () {
      console.log('Radio selecionado');
      updateOutput();

      // Acesse a checkbox associada ao radio, que está dentro da mesma <label> do <input> de checkbox
      const checkboxLabel = radio.closest('li').querySelector('label');
      const checkbox = checkboxLabel ? checkboxLabel.querySelector('input[type="checkbox"]') : null;

      console.log(checkbox); // Debug para ver o que é encontrado

      if (checkbox && !checkbox.checked) {
        checkbox.checked = true; // Marca a checkbox associada ao radio
      }

      validateCheckboxAndRadio(); // Validação após alteração
    });
  });

    // Inicia a verificação se o elemento está presente
    waitForElement();
  </script>

  <script>
    document.addEventListener('DOMContentLoaded', function () {
  // Função para verificar se o elemento com data-title="Take-off Information" existe
  function waitForElement() {
    const targetElement = document.querySelector('[data-title="Take-off Information"]');

    // Se o elemento existe, chama a função de inicialização
    if (targetElement) {
      init();
    } else {
      // Caso o elemento não exista ainda, observe o DOM
      setTimeout(waitForElement, 100);  // Tenta novamente após 100ms
    }
  }

  function init() {
    // Encontrando a section com data-title="Take-off Information"
    const targetSection = document.querySelector('[data-title="Take-off Information"]');

    if (targetSection) {
      // Criar o botão dinamicamente
      const submitButton = document.createElement('button');
      submitButton.type = 'submit'; // Define como botão de envio
      submitButton.classList.add('msf-btn', 'primary'); // Adiciona classes para estilo
      submitButton.textContent = 'Proceed with Take-off'; // Texto do botão

      // Encontrando o elemento msf-nav onde o botão será adicionado
      const nav = targetSection.querySelector('.msf-nav');

      // Verifique se a section contém o nav e adicione o botão
      if (nav) {
        nav.innerHTML = ''; // Limpa o conteúdo atual do nav (se houver)
        nav.appendChild(submitButton); // Adiciona o novo botão de submit
      }
    }
  }

  // Inicia a verificação se o elemento está presente
  waitForElement();
});

  </script>

  <script>
    if ('WebSocket' in window) {
      (function () {
        function refreshCSS() {
          var sheets = [].slice.call(document.getElementsByTagName("link"));
          var head = document.getElementsByTagName("head")[0];
          for (var i = 0; i < sheets.length; ++i) {
            var elem = sheets[i];
            var parent = elem.parentElement || head;
            parent.removeChild(elem);
            var rel = elem.rel;
            if (elem.href && typeof rel != "string" || rel.length == 0 || rel.toLowerCase() == "stylesheet") {
              var url = elem.href.replace(/(&|\?)_cacheOverride=\d+/, '');
              elem.href = url + (url.indexOf('?') >= 0 ? '&' : '?') + '_cacheOverride=' + (new Date().valueOf());
            }
            parent.appendChild(elem);
          }
        }
        var protocol = window.location.protocol === 'http:' ? 'ws://' : 'wss://';
        var address = protocol + window.location.host + window.location.pathname + '/ws';
        var socket = new WebSocket(address);
        socket.onmessage = function (msg) {
          if (msg.data == 'reload') window.location.reload();
          else if (msg.data == 'refreshcss') refreshCSS();
        };
        if (sessionStorage && !sessionStorage.getItem('IsThisFirstTime_Log_From_LiveServer')) {
          console.log('Live reload enabled.');
          sessionStorage.setItem('IsThisFirstTime_Log_From_LiveServer', true);
        }
      })();
    } else {
      console.error('Upgrade your browser. This Browser is NOT supported WebSocket for Live-Reloading.');
    }
  </script>
  <!-- >>> ADD (Delegated behavior + validation + summary) -->
<script>
(function () {
  const containerSel = '.hs_building_occupancy_type';
  const form = document.querySelector('#hsForm_b1918b8e-61ec-4407-94bd-8c949ebc59a4') || document.querySelector('form');

  function updateSummary() {
    const container = document.querySelector(containerSel);
    if (!container) return;
    const groups = container.querySelectorAll(':scope .hs-form-checkbox');
    const parts = [];
    groups.forEach(li => {
      const cb = li.querySelector(':scope > label input[type="checkbox"]');
      const label = li.querySelector(':scope > label span')?.textContent?.trim() || '';
      if (!cb || !cb.checked) return;
      const selRadios = li.querySelectorAll('.radio-group input[type="radio"]:checked');
      if (selRadios.length) {
        const rtxt = Array.from(selRadios).map(r => r.nextElementSibling?.textContent?.trim() || '').join(', ');
        parts.push(`${label}: ${rtxt}`);
      } else {
        parts.push(label);
      }
    });
    const summaryField = document.getElementById('building_occupancy_summary');
    if (summaryField) summaryField.value = parts.join('; ');
  }

  function showErr(li, msg) {
    let el = li.querySelector('.validation-error');
    if (!el) { el = document.createElement('span'); el.className = 'validation-error'; li.appendChild(el); }
    el.textContent = msg;
  }
  function hideErr(li) {
    const el = li.querySelector('.validation-error');
    if (el) el.remove();
  }

  if (form) {
    form.addEventListener('submit', (e) => {
      const container = document.querySelector(containerSel);
      if (!container) return;
      let ok = true;
      container.querySelectorAll(':scope .hs-form-checkbox').forEach(li => {
        const cb = li.querySelector(':scope > label input[type="checkbox"]');
        const radios = li.querySelectorAll('.radio-group input[type="radio"]');
        const anyRadio = Array.from(radios).some(r => r.checked);
        if (cb && cb.checked && radios.length && !anyRadio) {
          ok = false;
          showErr(li, 'Please select at least one option.');
        }
      });
      if (!ok) {
        e.preventDefault();
        const dd = container.closest('.dropdown');
        if (dd) {
          dd.setAttribute('aria-expanded', 'true');
          dd.querySelector('.dropdown__button')?.setAttribute('aria-expanded','true');
          dd.querySelector('.dropdown__panel').hidden = false;
        }
      } else {
        updateSummary();
      }
    });
  }

  updateSummary();
})();
</script>

<script>
(function () {
  const containerSel = '.hs_building_occupancy_type';
  const form = document.querySelector('#hsForm_b1918b8e-61ec-4407-94bd-8c949ebc59a4') || document.querySelector('form');

  function updateSummary() {
    const container = document.querySelector(containerSel);
    if (!container) return;
    const groups = container.querySelectorAll(':scope .hs-form-checkbox');
    const parts = [];
    groups.forEach(li => {
      const cb = li.querySelector(':scope > label input[type="checkbox"]');
      const label = li.querySelector(':scope > label span')?.textContent?.trim() || '';
      if (!cb || !cb.checked) return;
      const selRadios = li.querySelectorAll('.radio-group input[type="radio"]:checked');
      if (selRadios.length) {
        const rtxt = Array.from(selRadios).map(r => r.nextElementSibling?.textContent?.trim() || '').join(', ');
        parts.push(`${label}: ${rtxt}`);
      } else {
        parts.push(label);
      }
    });
    const summaryField = document.getElementById('building_occupancy_summary');
    if (summaryField) summaryField.value = parts.join('; ');
  }

  function showErr(li, msg) {
    let el = li.querySelector('.validation-error');
    if (!el) { el = document.createElement('span'); el.className = 'validation-error'; li.appendChild(el); }
    el.textContent = msg;

    // ensure dropdown is open so the user can see it
    const dd = li.closest('.dropdown');
    if (dd) {
      dd.setAttribute('aria-expanded', 'true');
      dd.querySelector('.dropdown__button')?.setAttribute('aria-expanded','true');
      const panel = dd.querySelector('.dropdown__panel');
      if (panel) panel.hidden = false;
    }
  }

  function hideErr(li) {
    const el = li.querySelector('.validation-error');
    if (el) el.remove();
  }

  document.addEventListener('change', (e) => {
    // Checkbox toggles its radio-group and validates immediately
    if (e.target.matches('.hs-form-checkbox > label > input[type="checkbox"]')) {
      const li = e.target.closest('.hs-form-checkbox');
      const rg = li.querySelector('.radio-group');
      if (rg) {
        rg.style.display = e.target.checked ? 'block' : 'none';
        if (!e.target.checked) rg.querySelectorAll('input[type="radio"]').forEach(r => r.checked = false);
      }

      // immediate validation for groups that have radios
      const hasRadios = !!li.querySelector('.radio-group input[type="radio"]');
      const anyRadio = !!li.querySelector('.radio-group input[type="radio"]:checked');
      if (e.target.checked && hasRadios && !anyRadio) {
        showErr(li, 'Please select at least one option.');
      } else {
        hideErr(li);
      }

      updateSummary();
      return;
    }

    // Radio ensures parent checkbox is checked & clears error
    if (e.target.matches('.radio-group input[type="radio"]')) {
      const li = e.target.closest('.hs-form-checkbox');
      const parentCheckbox = li?.querySelector(':scope > label input[type="checkbox"]');
      if (parentCheckbox && !parentCheckbox.checked) {
        parentCheckbox.checked = true;
        parentCheckbox.dispatchEvent(new Event('change', { bubbles: true }));
      }
      hideErr(li);
      updateSummary();
    }
  });

  // Keep submit validation (fallback)
  if (form) {
    form.addEventListener('submit', (e) => {
      const container = document.querySelector(containerSel);
      if (!container) return;
      let ok = true;
      container.querySelectorAll(':scope .hs-form-checkbox').forEach(li => {
        const cb = li.querySelector(':scope > label input[type="checkbox"]');
        const radios = li.querySelectorAll('.radio-group input[type="radio"]');
        const anyRadio = Array.from(radios).some(r => r.checked);
        if (cb && cb.checked && radios.length && !anyRadio) {
          ok = false;
          showErr(li, 'Please select at least one option.');
        }
      });
      if (!ok) {
        e.preventDefault();
      } else {
        updateSummary();
      }
    });
  }

  updateSummary();
})();
</script>


</body>
</html>


